/**
 * Async Request Controller - jQuery plugin for requests asynchronously
 *
 * Copyright (c) 2016 lucasantanaweb@gmail.com
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://lucaszanevich.com.br/async-request-controller/
 *
 * Version:  1.0.0
 *
 */
!function(a){jQuery.fn.asyncController=function(b){var c={requests:0,requestMethod:"GET",requestType:"html",requestAttempts:0,requestAttemptsTimer:5e3,requestData:{},targetProgress:null,progressEffect:!0,before:function(){},success:function(){},always:function(){}},d=a(this),e=a.extend({},c,b),f={requests:[],requestData:[],requestRunning:0,requestRunningAttempts:{},requestCall:0,requestNum:0,requestComplete:0,requestNumTotal:0,requestTimer:null,requestAgain:{},requestActiveAttempts:!1},g={finishRequests:!1};for(var h in e.requests)e.requests.hasOwnProperty(h)&&f.requests.push(e.requests[h]);for(var h in e.requestData)e.requestData.hasOwnProperty(h)&&f.requestData.push(e.requestData[h]);if("undefined"===jQuery.type(f.requests.length)||0==f.requests)return console.log("No data requests");f.requestCall=0,f.requestActiveAttempts=!1,f.requestRunningAttempts={},f.requestAgain={},f.requestNum=f.requests.length,f.requestNumTotal=f.requests.length,f.requestComplete=0,setTimeout(function(){m(0),i(500)},500);var i=function(a){f.requestTimer=setInterval(function(){0==f.requestRunning&&0!=f.requestNum&&j()},a)},j=function(){a.ajax({url:f.requests[f.requestCall],type:e.requestMethod,dataType:e.requestType,data:f.requestData[f.requestCall],beforeSend:function(){f.requestRunning=1,e.before()}}).done(function(a){e.success(a),f.requestComplete=f.requestComplete+1}).always(function(a){f.requestRunning=0;var b=!1;if("undefined"===jQuery.type(f.requestRunningAttempts[f.requestCall])?"undefined"!==jQuery.type(a.abort)&&0!=a.abort.length&&(f.requestAgain[f.requestCall]=f.requests[f.requestCall],f.requestRunningAttempts[f.requestCall]=1,b=!0):"undefined"===jQuery.type(a.abort)&&(f.requestRunningAttempts[f.requestCall]=e.requestAttempts),k(),0!=f.requestCall||f.requestActiveAttempts||(f.requestCall=f.requestNumTotal),!b){var c=Math.floor(f.requestComplete/f.requestNumTotal*100);m(c)}0==f.requestNum&&(g.finishRequests=!0),e.always(g)})},k=function(){if(f.requestNum>1)f.requestActiveAttempts?f.requestRunningAttempts[f.requestCall]>=e.requestAttempts?(delete f.requestAgain[f.requestCall],delete f.requestRunningAttempts[f.requestCall],f.requestNum=f.requestNum-1,f.requestCall=Object.keys(f.requestAgain)[0]):f.requestRunningAttempts[f.requestCall]=f.requestRunningAttempts[f.requestCall]+1:(f.requestNum=f.requestNum-1,f.requestCall=f.requestCall+1);else if(f.requestActiveAttempts)f.requestRunningAttempts[f.requestCall]>=e.requestAttempts?(delete f.requestAgain[f.requestCall],delete f.requestRunningAttempts[f.requestCall],f.requestNum=0,f.requestCall=0,clearInterval(f.requestTimer),f.requestActiveAttempts=!1):f.requestRunningAttempts[f.requestCall]=f.requestRunningAttempts[f.requestCall]+1;else{var a=l();a||(f.requestNum=0,f.requestCall=0,clearInterval(f.requestTimer))}},l=function(){var a=Object.keys(f.requestAgain);return 0!=e.requestAttempts&&0!=a.length&&!f.requestActiveAttempts&&(f.requestNum=a.length,f.requestCall=a[0],f.requestActiveAttempts=!0,clearInterval(f.requestTimer),i(e.requestAttemptsTimer),!0)},m=function(a){var b={};return b[e.targetProgress]=a+"%",0==a?void d.animate(b,0):void(e.progressEffect?d.animate(b,1500):d.animate(b,0))}}}(jQuery);